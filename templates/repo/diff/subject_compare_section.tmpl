{{$Subject := .root.Subject}}
{{$Repo1 := .root.Repo1}}
{{$Repo2 := .root.Repo2}}
{{$SplitViewLines := .root.SplitViewLines}}
<colgroup class="diff-colgroup-desktop">
	<col width="50">
	<col width="10">
	<col>
	<col width="50">
	<col width="10">
	<col>
</colgroup>
<colgroup class="diff-colgroup-mobile">
	<col width="50">
	<col width="10">
	<col>
</colgroup>
<div class="segment">
	<div class="tw-flex tw-items-center diff-repo-header">
		<div class="tw-flex-1 tw-p-2">
			<strong>
				{{svg "octicon-repo-forked" 16}}
				<a href="/{{$Repo1.Owner.Name}}">{{$Repo1.Owner.Name}}</a> /
				<a href="/article/{{$Repo1.Owner.Name}}/{{$Subject.Name}}">{{$Subject.Name}}</a>
			</strong>
			<div class="tw-text-[#59636e] tw-text-[12px] tw-italic tw-mt-1 tw-ml-5">Last update: {{$Repo1.UpdatedUnix.AsTime.Format "2006-01-02 15:04:05"}}</div>
		</div>
		<div class="tw-flex-1 tw-p-2 tw-border-l tw-border-[#d1d9e0]">
			<strong>
				{{svg "octicon-repo-forked" 16}}
				<a href="/{{$Repo2.Owner.Name}}">{{$Repo2.Owner.Name}}</a> /
				<a href="/article/{{$Repo2.Owner.Name}}/{{$Subject.Name}}">{{$Subject.Name}}</a>
			</strong>
			<div class="tw-text-[#59636e] tw-text-[12px] tw-italic tw-mt-1 tw-ml-5">Last update: {{$Repo2.UpdatedUnix.AsTime.Format "2006-01-02 15:04:05"}}</div>
		</div>
	</div>
</div>
{{range $i, $line := $SplitViewLines}}
	{{if eq $line.LeftType 1}}{{/* Both sides are plain/equal - show once on mobile */}}
		<tr class="same-code nl-{{$i}} ol-{{$i}}" data-line-type="same">
			<td class="lines-num lines-num-old" data-line-num="{{$line.LeftIdx}}">
				<span>{{$line.LeftIdx}}</span>
			</td>
			<td class="lines-type-marker lines-type-marker-old">
				<span class="tw-font-mono" data-type-marker=" "></span>
			</td>
			<td class="lines-code lines-code-old">
				<code class="code-inner">{{$line.LeftContent}}</code>
			</td>
			<td class="lines-num lines-num-new diff-desktop-only" data-line-num="{{$line.RightIdx}}">
				<span>{{$line.RightIdx}}</span>
			</td>
			<td class="lines-type-marker lines-type-marker-new diff-desktop-only">
				<span class="tw-font-mono" data-type-marker=" "></span>
			</td>
			<td class="lines-code lines-code-new diff-desktop-only">
				<code class="code-inner">{{$line.RightContent}}</code>
			</td>
		</tr>
	{{else}}{{/* Paired delete/add lines - mirror comparison */}}
		{{if and (eq $line.LeftType 3) (eq $line.RightType 2)}}
			{{/* Desktop: Both delete and add on same row */}}
			<tr class="del-code nl-{{$i}} ol-{{$i}} diff-desktop-only" data-line-type="diff">
				<td class="lines-num lines-num-old" data-line-num="{{$line.LeftIdx}}">
					<span>{{$line.LeftIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-old">
					<span class="tw-font-mono" data-type-marker="-"></span>
				</td>
				<td class="lines-code lines-code-old">
					<code class="code-inner">{{$line.LeftContent}}</code>
				</td>
				<td class="lines-num lines-num-new add-code" data-line-num="{{$line.RightIdx}}">
					<span>{{$line.RightIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-new add-code">
					<span class="tw-font-mono" data-type-marker="+"></span>
				</td>
				<td class="lines-code lines-code-new add-code">
					<code class="code-inner">{{$line.RightContent}}</code>
				</td>
			</tr>
			{{/* Mobile: Delete row first */}}
			<tr class="del-code nl-{{$i}}-del ol-{{$i}} diff-mobile-only" data-line-type="del">
				<td class="lines-num lines-num-old" data-line-num="{{$line.LeftIdx}}">
					<span>{{$line.LeftIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-old">
					<span class="tw-font-mono" data-type-marker="-"></span>
				</td>
				<td class="lines-code lines-code-old">
					<code class="code-inner">{{$line.LeftContent}}</code>
				</td>
			</tr>
			{{/* Mobile: Add row second */}}
			<tr class="add-code nl-{{$i}}-add ol-{{$i}} diff-mobile-only" data-line-type="add">
				<td class="lines-num lines-num-new" data-line-num="{{$line.RightIdx}}">
					<span>{{$line.RightIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-new">
					<span class="tw-font-mono" data-type-marker="+"></span>
				</td>
				<td class="lines-code lines-code-new">
					<code class="code-inner">{{$line.RightContent}}</code>
				</td>
			</tr>
		{{else if eq $line.LeftType 3}}
			{{/* Only delete on left, empty on right */}}
			<tr class="del-code nl-{{$i}} ol-{{$i}}" data-line-type="del">
				<td class="lines-num lines-num-old" data-line-num="{{$line.LeftIdx}}">
					<span>{{$line.LeftIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-old">
					<span class="tw-font-mono" data-type-marker="-"></span>
				</td>
				<td class="lines-code lines-code-old">
					<code class="code-inner">{{$line.LeftContent}}</code>
				</td>
				<td class="lines-num lines-num-new diff-desktop-only"></td>
				<td class="lines-type-marker lines-type-marker-new diff-desktop-only"></td>
				<td class="lines-code lines-code-new diff-desktop-only">
					<code class="code-inner"></code>
				</td>
			</tr>
		{{else if eq $line.RightType 2}}
			{{/* Only add on right, empty on left */}}
			<tr class="add-code nl-{{$i}} ol-{{$i}}" data-line-type="add">
				<td class="lines-num lines-num-old diff-desktop-only"></td>
				<td class="lines-type-marker lines-type-marker-old diff-desktop-only"></td>
				<td class="lines-code lines-code-old diff-desktop-only">
					<code class="code-inner"></code>
				</td>
				<td class="lines-num lines-num-new" data-line-num="{{$line.RightIdx}}">
					<span>{{$line.RightIdx}}</span>
				</td>
				<td class="lines-type-marker lines-type-marker-new">
					<span class="tw-font-mono" data-type-marker="+"></span>
				</td>
				<td class="lines-code lines-code-new">
					<code class="code-inner">{{$line.RightContent}}</code>
				</td>
			</tr>
		{{end}}
	{{end}}
{{end}}

