root = "."
tmp_dir = ".air"

[build]
pre_cmd = ["killall -9 gitea 2>/dev/null || true"]

# Build a debug-friendly binary with DWARF info:
# NOTE: GOFLAGS must not contain a bare "-l" token, so we pass -gcflags twice.
cmd = "bash -lc 'CGO_ENABLED=1 go build -tags \"${TAGS}\" -gcflags=all=-N -gcflags=all=-l -o ./gitea .'"

# Run it under delve, waiting for GoLand to attach
entrypoint = [
  "dlv", "exec",
  "--headless",
  "--listen=127.0.0.1:2345",
  "--api-version=2",
  "--accept-multiclient",
  "./gitea",
  "--",
  "web"
]

delay = 2000
include_ext = ["go", "tmpl"]
include_file = ["main.go"]
include_dir = ["cmd", "models", "modules", "options", "routers", "services"]
exclude_dir = [
  "models/fixtures",
  "models/migrations/fixtures",
  "modules/avatar/identicon/testdata",
  "modules/avatar/testdata",
  "modules/git/tests",
  "modules/migration/file_format_testdata",
  "routers/private/tests",
  "services/gitdiff/testdata",
]
exclude_regex = ["_test.go$", "_gen.go$"]
stop_on_error = true

[log]
main_only = true